<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Indie elements catalog">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <meta name="description" content="">

    <title>A thing</title>

    <script src="bower_components/webcomponentsjs/webcomponents-loader.js"></script>
    <link rel="import" href="bower_components/polymer/lib/mixins/gesture-event-listeners.html">
    <link rel="import" href="elements/drag-drop.html">
    <link rel="import" href="elements/app-shell.html">

    <custom-style>
    <style>
      body {
        margin: 0;
        font-family: 'Roboto', 'Noto', sans-serif;
        line-height: 1.5;
        min-height: 100vh;
        background-color: white;
      }

      .main {
        box-sizing: border-box;
        width: 100%;
        height: 500px;
        overflow: hidden;
        /* 10px grid, using http://www.patternify.com/ */
        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGUlEQVQYV2NkIBIwEqmOYVQh3pAiNnj+AwALaAEKfsPrZgAAAABJRU5ErkJggg==);
        background-position: 0px 0px;
      }
      .main > * {
        cursor: pointer;
      }
      .main > *.active {
        outline: solid 2px rgba(66, 87, 203, 0.8);
        outline-offset: -2px;
      }
      .main > *.dragging {
        opacity: 0.6;
      }
      button {
        background: transparent;
        border: none;
        font-size: inherit;
        display: block;
        margin-bottom: 12px;
      }

      #propertiesContainer label {
        color: #aaa;
        display: inline-block;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        font-size: 12px;
        width: 14px;
      }
      #propertiesContainer input {
        height: 24px;
        padding: 0 2px 0 4px;
        box-sizing: border-box;
        width: 60px;
        margin-right: 14px;
        margin-bottom: 8px;
      }
    </style>
    <custom-style>
  </head>
  <body>
    <app-shell>
      <div slot="properties" id="propertiesContainer">
        <label>X</label>
        <input type="number" id="activeX" data-type="left">
        <label>Y</label>
        <input type="number" id="activeY" data-type="top"><br>
        <label>W</label>
        <input type="number" id="activeW" data-type="width">
        <label>H</label>
        <input type="number" id="activeH" data-type="height">
      </div>
      <div slot="elements" id="elementsContainer">
        <button>input</button>
      </div>
      <div class="main" slot="main" id="viewContainer"></div>
    </app-shell>

    <noscript>
      Please enable JavaScript to view this website.
    </noscript>

    <script>
      var activeElement;
      var grid = 10;

      window.addEventListener('WebComponentsReady', function() {
        elementsContainer.addEventListener('click', addElement);

        propertiesContainer.addEventListener('input', updateElementSize);

        viewContainer.addEventListener('click', selectElement);
        Polymer.Gestures.addListener(viewContainer, 'track', trackElement);
      });

      function addElement(event) {
        var el = event.target;
        console.log('create a new ', el.textContent);
        var el = document.createElement(el.textContent);
        el.style.position = 'relative';
        el.style.left = el.style.top = '0';
        viewContainer.appendChild(el);
        updateActiveElement(el);
        displayElementProperties(el);
      }

      function selectElement(event) {
        console.log('select', event);
        var el = event.target;
        updateActiveElement(el);
        displayElementProperties(el);
      }

      function trackElement(event) {
        var el = event.target;

        switch(event.detail.state) {
          case 'start':
            el.classList.add('dragging');
            break;
          case 'track':
            window._trackx = Math.round(event.detail.dx / grid) * grid;
            window._tracky = Math.round(event.detail.dy / grid) * grid;
            el.style.transform = el.style.webkitTransform =
              'translate(' + _trackx + 'px, ' + _tracky + 'px)';
            break;
          case 'end':
            el.classList.remove('dragging');
            var local = el.getBoundingClientRect();
            var parent = el.parentElement.getBoundingClientRect();
            el.style.left = local.left - parent.left + 'px';
            el.style.top = local.top - parent.top + 'px';
            el.style.transform = el.style.webkitTransform = 'none';
            el.getBoundingClientRect();
            break;
        }
      }

      function updateActiveElement(el) {
        if (activeElement) {
          activeElement.classList.remove('active');
        }
        el.classList.add('active');
        activeElement = el;
      }

      function displayElementProperties(el) {
        var rekt = el.getBoundingClientRect();
        activeX.value = rekt.left;
        activeY.value = rekt.top;
        activeW.value = rekt.width;
        activeH.value = rekt.height;
      }

      function updateElementSize(event) {
        var inputEl = event.target;
        var type = inputEl.dataset.type;
        activeElement.style[type] = inputEl.value + 'px';
      }
    </script>
  </body>
</html>
