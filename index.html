<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Indie elements catalog">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <meta name="description" content="">

    <title>A thing</title>

    <script src="bower_components/webcomponentsjs/webcomponents-loader.js"></script>
    <link rel="import" href="bower_components/polymer/lib/mixins/gesture-event-listeners.html">
    <link rel="import" href="elements/app-shell.html">

    <custom-style>
    <style>
      body {
        margin: 0;
        font-family: 'Roboto', 'Noto', sans-serif;
        line-height: 1.5;
        min-height: 100vh;
        background-color: white;
      }

      .main {
        box-sizing: border-box;
        width: 100%;
        height: 500px;
        overflow: hidden;
        /* 10px grid, using http://www.patternify.com/ */
        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGUlEQVQYV2NkIBIwEqmOYVQh3pAiNnj+AwALaAEKfsPrZgAAAABJRU5ErkJggg==);
        background-position: 0px 0px;
      }
      .main > * {
        cursor: pointer;
      }
      .main > *.active {
        outline: solid 2px rgba(66, 87, 203, 0.8);
        outline-offset: -2px;
      }
      .main > *.dragging {
        opacity: 0.6;
      }
      button {
        background: transparent;
        border: none;
        font-size: inherit;
        display: block;
        margin-bottom: 12px;
      }

      #stylesContainer label, #propertiesContainer label {
        float: left;
        display: block;
        width: 150px;
        margin-right: 20px;
        line-height: 1.2em;
      }
    </style>
    <custom-style>
  </head>
  <body>
    <app-shell>
      <div slot="properties" id="propertiesContainer">
        <label>textContent</label>
        <input name="textContent">
        <label>id</label>
        <input name="id">
        <label>className</label>
        <input name="className">
        <label>attributes</label>
        <input name="attributes">
      </div>
      <div slot="styles" id="stylesContainer">
        <label>background color</label>
        <input name="backgroundColor" type="color">
        <label>border</label>
        <input name="border">
        <label>opacity</label>
        <input name="opacity" type="range" min="0" max="1" step="0.1" value="1">
        <label>padding</label>
        <input name="padding">
        <label>margin</label>
        <input name="margin">
        <label>position</label>
        <select name="position">
          <option>static</option>
          <option>absolute</option>
          <option>relative</option>
        </select>
        <label>left</label>
        <input name="left">
        <label>top</label>
        <input name="top">
        <label>display</label>
        <input name="display">
        <label>width</label>
        <input name="width">
        <label>height</label>
        <input name="height">
      </div>
      <div slot="elements" id="elementsContainer">
        <button>input</button>
      </div>
      <div class="main" slot="main" id="viewContainer"></div>
    </app-shell>

    <noscript>
      Please enable JavaScript to view this website.
    </noscript>

    <script>
      var activeElement;
      var grid = 10;
      var stylesList = [];
      var propertiesList = [];

      window.addEventListener('WebComponentsReady', function() {
        initializeAvailableStyles();
        initializeAvailableProperties();

        elementsContainer.addEventListener('click', addElement);

        stylesContainer.addEventListener('input', updateElementStyles);
        propertiesContainer.addEventListener('input', updateElementProperties);

        viewContainer.addEventListener('click', selectElement);
        Polymer.Gestures.addListener(viewContainer, 'track', trackElement);
      });

      function initializeAvailableStyles() {
        var els = stylesContainer.querySelectorAll('[name]');
        for (var i = 0 ; i < els.length; i++) {
          stylesList.push(els[i].name);
        }
      }

      function initializeAvailableProperties() {
        var els = propertiesContainer.querySelectorAll('[name]');
        for (var i = 0 ; i < els.length; i++) {
          propertiesList.push(els[i].name);
        }
      }

      function addElement(event) {
        var el = event.target;
        var el = document.createElement(el.textContent);
        el.style.position = 'relative';
        el.style.left = el.style.top = '0';
        viewContainer.appendChild(el);
        updateActiveElement(el);
        displayElementStyles(el);
        displayElementProperties(el);
      }

      function selectElement(event) {
        var el = event.target;
        updateActiveElement(el);
        displayElementProperties(el);
        displayElementStyles(el);
      }

      function trackElement(event) {
        var el = event.target;

        switch(event.detail.state) {
          case 'start':
            el.classList.add('dragging');
            break;
          case 'track':
            window._trackx = Math.round(event.detail.dx / grid) * grid;
            window._tracky = Math.round(event.detail.dy / grid) * grid;
            el.style.transform = el.style.webkitTransform =
              'translate(' + _trackx + 'px, ' + _tracky + 'px)';
            break;
          case 'end':
            el.classList.remove('dragging');
            var local = el.getBoundingClientRect();
            var parent = el.parentElement.getBoundingClientRect();
            el.style.left = local.left - parent.left + 'px';
            el.style.top = local.top - parent.top + 'px';
            el.style.transform = el.style.webkitTransform = 'none';
            el.getBoundingClientRect();
            break;
        }
      }

      function updateActiveElement(el) {
        if (activeElement) {
          activeElement.classList.remove('active');
        }
        el.classList.add('active');
        activeElement = el;
      }

      function displayElementProperties(el) {
        for (var i = 0; i < propertiesList.length; i++) {
          var inputEl = document.querySelector(`[name=${propertiesList[i]}]`);
          if (propertiesList[i] === 'attributes') {
            var v = '';
            for(var a = 0; a < el.attributes.length; a++) {
              var name = el.attributes[a].name;
              if (name != 'class' && name != 'style' && name != 'id') {
                v += name + '=' + el.attributes[a].value + ' ';
              }
            }
            inputEl.value = v.trim();
          } else if (propertiesList[i] === 'className') {
            inputEl.value = el[propertiesList[i]].replace('active', '');
          } else {
            inputEl.value = el[propertiesList[i]];
          }
        }
      }

      function displayElementStyles(el) {
        var styles = window.getComputedStyle(el);

        for (var i = 0; i < stylesList.length; i++) {
          var inputEl = document.querySelector(`[name=${stylesList[i]}]`);
          if (stylesList[i] === 'backgroundColor') {
            inputEl.value = rgb2hex(styles[stylesList[i]]);
          } else {
            inputEl.value = styles[stylesList[i]];
          }
        }
      }

      function updateElementStyles(event) {
        var inputEl = event.target;
        var name = inputEl.name;
        activeElement.style[name] = inputEl.value;
      }

      function updateElementProperties(event) {
        var inputEl = event.target;
        var name = inputEl.name;
        activeElement[name] = inputEl.value;
      }

      function rgb2hex(rgb){
       rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
       return (rgb && rgb.length === 4) ? "#" +
        ("0" + parseInt(rgb[1],10).toString(16)).slice(-2) +
        ("0" + parseInt(rgb[2],10).toString(16)).slice(-2) +
        ("0" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';
      }
    </script>
  </body>
</html>
