<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-behaviors/iron-control-state.html">
<dom-module id="paper-cascading-option">
  <template>
    <style>
      :host {
        position: relative;
        display: flex;
        flex-direction: row;
        align-items: center;
        color: #202020;
      }

      #triggerContainer {
        display: flex;
        flex: 1 1 auto;
        flex-direction: column;
      }

      :host(:not(.show-arrow)) > #arrow {
        display: none;
      }

      #arrow {
        width: 8px;
        height: 0;
        border-style: solid;
        border-width: 5px 0 5px 5px;
        border-color: transparent transparent transparent #555555;
        padding-right: 24px;
      }
    </style>
    <slot name="menu"></slot>
    <div id="triggerContainer">
      <slot id="trigger"></slot>
    </div>
    <div id="arrow"></div>
  </template>
  <script>
    Polymer({
      is: 'paper-cascading-option',

      behaviors: [
        Polymer.IronControlState
      ],

      properties: {
        active: {
          type: Boolean,
          value: false
        },

        isSubmenu: {
          type: Boolean,
          computed: '__computeIsSubmenu(__childMenu)'
        },

        disabled: {
          type: Boolean,
          value: false
        },

        __childMenu: {
          type: Object,
          observer: '__childMenuChanged'
        }
      },

      observers: [
        '__activeChanged(active)',
        '__disabledChanged(disabled, isAttached)'
      ],

      listeners: {
        'mouseenter': '__onMouseenter'
      },

      get childMenu() {
        return this.__childMenu;
      },

      attached: function() {
        var self = Polymer.dom(this);
        this.__childMenu = self.querySelector('paper-cascading-menu');
        this.__triggerNodes = Polymer.dom(this.$.trigger).getDistributedNodes() || [];
      },

      __activeChanged: function(active) {
        if (!this.childMenu) {
          return;
        }

        if (active) {
          this.childMenu.open();
        } else {
          this.childMenu.close();
        }
      },

      __onMouseenter: function() {
        this.fire('paper-cascading-option-enter');
      },

      __childMenuChanged: function(childMenu) {
        this.debounce('child-menu-changed', function() {
          Polymer.RenderStatus.afterNextRender(this, function() {
            var showArrow = childMenu != null && childMenu.isRootMenu === false;
            this.classList.toggle('show-arrow', showArrow);
          });
        });
      },

      __computeIsSubmenu: function(childMenu) {
        return childMenu != null;
      },

      __disabledChanged: function(disabled, isAttached) {
        this.debounce('disabled-changed', function() {
          this.__triggerNodes.forEach(function(node) {
            node.disabled = this.disabled;
          }, this);
        });
      }
    });
  </script>
</dom-module>
