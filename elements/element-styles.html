<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="element-styles">
  <template>
    <style>
      :host{
        display: block;
        box-sizing: border-box;
      }
      label {
        float: left;
        display: block;
        width: 150px;
        margin-right: 20px;
        line-height: 1.2em;
      }
    </style>
    <label>background color</label>
    <input name="backgroundColor" type="color">
    <label>border</label>
    <input name="border">
    <label>opacity</label>
    <input name="opacity" type="range" min="0" max="1" step="0.1" value="1">
    <label>padding</label>
    <input name="padding">
    <label>margin</label>
    <input name="margin">
    <label>position</label>
    <select name="position">
      <option>static</option>
      <option>absolute</option>
      <option>relative</option>
    </select>
    <label>left</label>
    <input name="left">
    <label>top</label>
    <input name="top">
    <label>display</label>
    <input name="display">
    <label>width</label>
    <input name="width">
    <label>height</label>
    <input name="height">

  </template>
  <script>
    class ElementProperties extends Polymer.Element {
      static get is() { return 'element-styles'; }
      ready() {
        super.ready();
        this._styles = [];
        var els = this.root.querySelectorAll('[name]');
        for (var i = 0 ; i < els.length; i++) {
          this._styles.push(els[i].name);
        }

        this.root.addEventListener('input', this._do.bind(this));
      }

      _do(event) {
        var newEvent = new Event('update-element', {
          bubbles: true,
          cancelable: false,
          composed: true
        });
        var target = event.path[0];

        newEvent.detail = {
          type: 'style',
          name: target.name,
          value: target.value
        };
        this.dispatchEvent(newEvent);
      }

      display(elementStyles) {
        for (var i = 0; i < this._styles.length; i++) {
          var name = this._styles[i];
          var el = this.root.querySelector(`[name=${name}]`);
          if (name === 'backgroundColor') {
            el.value = this._rgb2hex(elementStyles[name]);
          } else {
            el.value = elementStyles[name];
          }
        }
      }

      _rgb2hex(rgb) {
       rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
       return (rgb && rgb.length === 4) ? "#" +
        ("0" + parseInt(rgb[1],10).toString(16)).slice(-2) +
        ("0" + parseInt(rgb[2],10).toString(16)).slice(-2) +
        ("0" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';
      }
    }
    customElements.define(ElementProperties.is, ElementProperties);
  </script>
</dom-module>
