<script>
  (function() {
    window.ElementStuff = function(base) {
      return class extends base {
        ready() {
          super.ready();
          this._recomputeStuff();
          this.root.addEventListener('change', this._do.bind(this));
        }

        _recomputeStuff() {
          this._stuff = [];
          let els = this.root.querySelectorAll('[name]');
          for (let i = 0 ; i < els.length; i++) {
            this._stuff.push(els[i].name);
          }
        }

        _do(event) {
          let target = event.composedPath()[0];

          // Is it a custom thing?
          if (target.classList.contains('style-label')) {
            // Set the name on the next input
            target.nextElementSibling.name = target.value;
            this._recomputeStuff();
            return;
          }

          let newEvent = new Event('element-updated', {
            bubbles: true,
            cancelable: false,
            composed: true
          });
          newEvent.detail = {
            type: this.stuffType,
            name: target.name,
            value: target.value
          };
          this.dispatchEvent(newEvent);
        }
      }
    }
  })();
</script>
