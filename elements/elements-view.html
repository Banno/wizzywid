<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-cascading-menu/paper-cascading-menu.html">
<link rel="import" href="../bower_components/paper-cascading-menu/paper-cascading-menu-bar.html">
<link rel="import" href="../bower_components/paper-cascading-menu/paper-cascading-option.html">
<link rel="import" href="../bower_components/paper-cascading-menu/paper-cascading-menu-item-styles.html">
<link rel="import" href="app-icons.html">

<dom-module id="elements-view">
  <template strip-whitespace>
    <style include="paper-cascading-menu-item-styles">
      :host {
        display: block;
        width: 100%;
      }

      paper-cascading-menu-bar {
        background: transparent;
        color: white;
        padding: 0;
        margin: 8px;
      }

      paper-cascading-menu-bar > paper-cascading-option > :not(paper-cascading-menu) {
        padding: 0;
      }

      paper-cascading-menu-bar .iron-selected {
        background: transparent;
        color: white;
      }

      paper-cascading-menu[narrow] {
        width: 200px
      }

      button.insert {
        color: white;
        display: flex;
        flex-direction: column;
      }
      button.insert span {
        font-size: 10px;
      }
    </style>
    <paper-cascading-menu-bar id="menu">
      <paper-cascading-option>
        <button class="insert">
          <iron-icon icon="designer:insert"></iron-icon>
          <span>Insert</span>
        </button>

        <paper-cascading-menu slot="menu" narrow>
          <paper-cascading-option>
            <button>Native elements</button>
            <paper-cascading-menu narrow slot="menu">
              <button>input</button>
              <button>div</button>
              <button>button</button>
            </paper-cascading-menu>
          </paper-cascading-option>

          <paper-cascading-option>
            <button>Paper elements</button>
            <paper-cascading-menu narrow slot="menu">
              <button>paper-input</button>
              <button>paper-button</button>
            </paper-cascading-menu>
          </paper-cascading-option>
        </paper-cascading-menu>
      </paper-cascading-option>
    </paper-cascading-menu-bar>
  </template>
  <script>
    class ElementsView extends Polymer.Element {
      static get is() { return 'elements-view'; }

      ready() {
        super.ready();
        this.addEventListener('click', this.addElement.bind(this));
        this._nativeElementsWhitelist = ['div', 'input', 'button'];
      }

      addElement(event) {
        var target = event.path[0];
        var kind = target.textContent;
        if (target.tagName !== 'BUTTON' || target.classList.contains('toggle')) {
          return;
        }

        if (this._nativeElementsWhitelist.indexOf(kind) === -1) {
          var url = `bower_components/${kind}/${kind}.html`;
          Polymer.Base.importHref(url, function(e) {
            this.finishCreatingElement(kind);
          }.bind(this));
        } else {
            this.finishCreatingElement(kind);
        }
      }

      finishCreatingElement(kind) {
        var newEvent = new Event('new-element', {
          bubbles: true,
          cancelable: false,
          composed: true
        });
        newEvent.detail = {
          type: kind
        };
        this.dispatchEvent(newEvent);
      }
    }
    customElements.define(ElementsView.is, ElementsView);
  </script>
</dom-module>
